{include file="common/header"}
 <link href="http://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
<link href="http://cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
<link async rel="stylesheet" href="https://cdn.materialdesignicons.com/1.8.36/css/materialdesignicons.min.css"/>
<link async rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/material-design-iconic-font/2.2.0/css/material-design-iconic-font.min.css"/>
<link async rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/typicons/2.0.7/typicons.min.css"/>
<link async rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css"/>
<link  href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="__CSS__/demo.css">
<link rel="stylesheet" type="text/css" href="__CSS__/pretty.min.css">
<style>
    html{
        font-size: 10px;
    }
    .pretty{
        width:100%;
        padding: 7px 5px 4px;
        border-radius: 5px;
        background: #dddddd;
    }
    .pretty label{
        padding-left:30px;
        font-size: 1.5rem;
    }
    .pretty i{
        position:absolute;
        left:10px;
    }
    .DiaoYan{
        width: 90%;
        margin: 35% auto 30px;
        /*overflow: hidden;
        padding-bottom: 30px;*/
        background: #fff;
        border-radius: 5px;
        box-shadow: 0 0 10px #666;
    }
    .container_duoxuan{
        color: #333;
    }

    h2{
        font-size: 16px;
        line-height: 24px;
        margin:0;
        padding: 20px 15px;
    }
    ul{
        width: 90%;
        margin: 0 auto;
        overflow: hidden;
    }
    li{
        width: 100%;
        overflow: hidden;
        font-size: 14px;
        margin-bottom: 15px;
    }
    li p{
        float: left;
        max-width: calc(100% - 20px);
    }
    .Ti_Color{
        color: #d0784c;
    }
    .Ti_Color p{
        text-decoration: underline;
    }

    .turn_box{
        width: 90%;
        margin: 15px auto;
        overflow: hidden;
    }
    .turn_left{
        float: left;
        padding: 5px 15px;
        border-radius: 5px;
        background: none;
        text-align: center;
        color: #fda101;
        display: block;
        width:90px;
        font-size: 1.4rem;
    }
    .turn_right{
        float: right;
        padding: 5px 15px;
        border-radius: 5px;
        background: none;
        text-align: center;
        color: #fda101;
        display: block;
        width:90px;
        font-size: 1.4rem;
    }
    .submit_btn{
        margin-top: 30px;
        margin-left: calc(20% - 5px);
        display: block;
        width: 60%;
        padding: 5px 0;
        font-size: 1.4rem;
        border-radius: 5px;
        background: #fda101;
        text-align: center;
        color: #fff;
        float: left;
    }
    .sq-head{
        background: rgba(0,0,0,0.6);
    }
    .checkbox1_0,.checkbox1_2{
        background: #dddddd;
        border: 0;
        border-radius: 5px;
        font-size: 1.5rem;
        width: 100%;
    }
    .Ti_box{
        overflow: hidden;
    }
    .name_head{
        display: block;
        width: 50%;
        text-align: center;
        line-height: 4rem;
        margin: 0 auto;
        background: #fda101;
        font-size: 1.6rem;
        color: #fff;
        position: relative;
        top: -1rem;
        border-bottom-left-radius: 3rem;
        border-bottom-right-radius: 3rem;
        border-top-left-radius: 10px;
        border-top-right-radius: 10px;
    }
</style>
<img style="position: fixed; width: 100%; height: 100%; top:0;
left: 0; z-index: -1;" src="http://huaruncard.redh5.cn/static/home/images/diaoyan_black.jpg"/>

<!--图片轮换-->
<header data-am-widget="header" class="am-header am-header-default sq-head ">
    <div class="am-header-left am-header-nav">
        <a href="javascript:history.back()" class="">
            <i class="am-icon-chevron-left"></i>
        </a>
    </div>
    <h1 class="am-header-title" style="line-height: 49px;">
        <a href="" class="">{$title}</a>
    </h1>
</header>
<div style="height: 49px;"></div>
<div class="DiaoYan">
    <span class="name_head">第 （<font class="problem_num">1</font>/<font class="problem_count">0</font>） 题</span>
    <div class="Ti_box">
        
    </div>
    <input type="hidden" name="id" id="id" value="{$id}">
</div>

<script type="text/javascript">

        
    
    // $(function(){

        var num = 0;//初始数量

        var count = 0; //总数量

        var data = [];

        var id = $("#id").val()

        $.post("{:url('Index/ajax_diaoyan_list')}",{id: id},function(res){

            data = res.data
            count = res.data.length
            $(".problem_count").text(count)
            set_problem(data[num],num);
        })
 // Ti_Color 选中样式
        function set_problem(data,num){

            var html = ''
                html += '<div id="none_'+num+'">';
                html += '<h2 class="Ti_name">第'+(num+1)+'题：'+data.problem+'</h2>';

            if (data.type == 1) {

                html += '<div class="container container_duoxuan">';
                for (b in data.content) {
                    html +=    '<div class="pretty warning">';
                    html +=         '<input type="checkbox" class="checkbox_'+num+'" name="answer[]" data-id="'+data.id+'" data-type="'+data.type+'" value="'+b+'"/>';
                    html +=         '<label><i class="mdi mdi-check"></i>'+b+'. '+data.content[b]+'</label>';
                    html +=     '</div>';
                }
                html +=  '</div>';
            }else if(data.type == 0){

                html += '<div class="container container_danxuan">';
                for (b in data.content) {
                    html +=     '<div class="pretty inline">';
                    html +=         '<input class="checkbox checkbox_'+num+'" type="checkbox" name="answer[]" data-id="'+data.id+'" data-type="'+data.type+'" value="'+b+'">';
                    html +=         '<label><i class="mdi mdi-check"></i>'+b+'. '+data.content[b]+'</label>';
                    html +=     '</div>';
                }
                html += '</div>';
            }else{

                html += '<div class="container container_danxuan">';
                html +=     '<div class="pretty inline">';
                html +=         '<textarea type="text" class="checkbox1_'+num+'" name="answer[]" data-id="'+data.id+'" data-type="'+data.type+'" placeholder="请输入内容" rows="10" cols="40"></textarea>';
                html +=     '</div>';
                html += '</div>';
            }

            html += '<div class="turn_box">';
            html +=     '<span class="turn_left" onclick="turn_left()"><上一题</span>';
            if (num+1 < count) {
                html +=     '<span class="turn_right" onclick="turn_right()">下一题></span>';
            }
            if (num+1 == count) {
                html +=     '<span class="submit_btn" onclick="submit_btn()">提交</span>';
            }
            html += '</div>';
            html += '</div>';

            // $(".Ti_box").html('')
            $(".Ti_box").append(html)

        }

        $(document).on('click','.checkbox',function(){

           $(".checkbox_"+num).prop('checked',false);  //取消当前题的全部选中

           $(this).prop('checked',true);  //选中当前
        })

        // $(document).on('click','.submit_btn',function(){
        function submit_btn(){

            var ids = []

            $.each($('textarea'),function(){ //文本
                ids.push({'problem_id':$(this).data('id'),answer:$(this).val(),'type':$(this).data('type')})
            });

            $.each($('input:checkbox:checked'),function(){
                ids.push({'problem_id':$(this).data('id'),answer:$(this).val(),'type':$(this).data('type')})
            });
            $.post("{:url('Index/diaoyan_add')}",{data:ids, questionnaire_id:id},function(data){

                alert(data.msg)
                window.history.go(-1);
            })
           
        }

        // $(document).on('click','.turn_right',function(){
        function turn_right(){

            if ($(".checkbox_"+num).is(":checked") == false && ($(".checkbox1_"+num).val() == undefined || $(".checkbox1_"+num).val() == '')) { //判断这道题选择没
                alert('请答题')
                return false
            }

            console.log(data)
            $("#none_"+num).css("display","none");
            num++;
            if ($("#none_"+num).length == 0) {
                set_problem(data[num],num);
            }else{
                $("#none_"+num).css("display","block");
            }
            $(".problem_num").text(num+1)
        }

        // $(document).on('click','.turn_left',function(){
        function turn_left(){
            if (num > 0) {
                $("#none_"+num).css("display","none");
                num--;
                $("#none_"+num).css("display","block");
                // set_problem(data[num],num);
                $(".problem_num").text(num+1)
            }
        }

    // })

</script>

{include file="common/footer"}